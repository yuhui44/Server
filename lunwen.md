
本科毕业论文




论文题目：      知识产权交易         
              平台的设计与实现       
指导老师：         朱定局            
学生姓名：         马逸青            
学    号：       20142100008         
学    院：       计算机学院          
专    业： 计算机科学与技术数据库方向
班    级：     2014级本科6班        

摘要
　　在新的知识创造日新月异的现代，知识产权逐渐为人们所重视，为了给我们企业与我们的知识创造者提供更加简单直观的交易体验，我们团队决心开发基于大数据的知识产权交易平台，为知识产权创造者和企业提供便利。
　　本文主要介绍知识产权交易平台的开发与维护。该平台给用户提供查看知识产权产品、与发布者取得联系、发布知识产权信息的功能，给管理员提供用户管理、数据维护的功能，其开发包括后台数据库的开发、后端API服务器的开发和前端界面的开发。
　　本平台采用Node.js作为后端API服务器，Node.js基于Chrome V8引擎开发，高速快速，适合知识产权交易平台此类I/O密集型Web应用，其丰富的模块和npm包也为平台开发提供便利化和结构清晰化；采用MongoDB作为网站数据库，MongoDB是基于分布式文件存储的数据库，具有非关系型数据库和关系型数据库的双重特点，性能高，扩展性强，为知识产权交易平台提供强有力的数据支撑，也为后续功能开发提供广阔空间；采用Vue.js作为前端框架，Vue.js是用于构建用户界面的渐进式框架，其具有数据驱动和组件化的特点，为知识产权交易平台的开发提供便利的MVVM开发模式；采用Element-UI响应式布局框架作为前端界面，利用其提供的丰富功能组件实现数据校验、页面自适应等多种功能。平台通过前后端分离为平台的开发提供更多可能，也可以有效减少网络数据传输，同时还可以将平台进行功能化区分，将数据库与API服务器与静态资源服务器分开，为平台的高稳定性和高并发性提供支持。

关键词  ：知识产权，交易平台，Node.js，MongoDB，Vue.js，前后端分离，MVVM

Abstract
In the 

Keywords  :web d

目录

1.绪论	4
1.1 选题背景	4
1.2 选题意义	4
2.可行性分析	5
2.1 技术可行性	5
2.2 经济可行性	8
2.3 社会可行性	9
2.4 开发可行性	9
2.5 操作可行性	9
3.需求分析	9
3.1 功能需求	9
3.2 安全需求	10
3.3 性能需求	10
4.总体设计	10
4.1 系统结构设计	10
4.2 系统功能设计	12
4.3 系统数据库设计	13
5.详细设计	13
5.1 控制层设计	13
5.2 模型层设计	13
5.3 数据库设计	14
6.系统测试与维护	14
6.1 白盒测试	14
6.2 黑盒测试	14
6.3 系统维护	14
参考文献	14
附录	14
致谢	14

1.绪论
1.1 选题背景
　　在新的知识、技术、创新创造日新月异的现代，知识产权逐渐为人们所重视，更多的知识创造者会为自己的知识产权申请专利，这一方面是为了通过法律的手段保护自身的知识产权专利，另一方面是为了知识产权可以得到尊重，可以在交易市场中流通创造价值。近年来，国家在知识产权的保护上不断加大力度，坚决打击侵犯知识产权的行为，为鼓励知识创造打下了基础，然而在保护知识产权的过程中，我们也要做到疏与堵结合，不仅要堵住侵犯知识产权的违法行为，也要疏通知识产权的交易流通，让知识产权造福我们的企业、产品，也造福我们的知识创造者。
　　国家也对互联网加以重视，提出了“互联网+”的创新理念，我们现在已踏入“互联网＋”的新时代，许多传统的产业、工作方式通过与“互联网+”结合，成功实现了新发展。
　　在Web技术日新月异的今天，计算机硬件和软件不断发展，Web开发不再遥不可及，学生也可以通过自身的知识学习，借助成熟的开发框架和设计方法完成Web网站的开发。
　　为了给企业与知识产权创造者提供更好的交易环境，市场上相继诞生了一些知识产权交易平台，但这些平台大多运营时间短，缺少专业的运营团队，在平台更新和用户体验上普遍落后，市场急需一个安全可靠、数据齐全的知识产权交易平台。
1.2 选题意义
　　为了给我们企业与我们的知识创造者提供更加简单直观的交易体验，我们团队决心开发基于大数据的知识产权交易平台。知识产权创造者可以通过平台发布自有知识产权信息，既增加知识产权的影响力，扩大创造者知名度，也可以为知识创造者寻得有意合作的合作方。企业可以通过平台检索需要的知识产权，了解知识产权的详细信息并进行对比，还可与发布者取得联系，详细了解有关知识产权的具体细节。而我们平台作为可信的第三方，可以为他们双方提供政策上的帮助指引，避免不必要的的交易纠纷。知识产权创造者、企业与我们平台三方通过这一平台，跨越现实的地理间隔，实现知识产权交易全球化、电子化、信息化。我们团队也在项目中引入大数据工具，将互联网上现有的知识产权信息进行整理，方便需求者检索。
　　平台采用B/S架构，企业与知识创造者都可以方便的通过电脑或手机的浏览器进行浏览，平台采用自适应的界面设计，在电脑端和手机端都有良好的体验，交互性强，且网站在运营阶段升级功能无需升级客户端，只需更新服务器代码即可，而Node.js + MongoDB + Vue.js的组合学习难度低，开发简便，扩展性强，还能在网站访问量逐渐提升后适时地进行扩容，这样的开发技术已渐渐为开发者接受与应用。

图：B/S架构图
2.可行性分析
2.1 技术可行性
　　平台开发采用成熟稳定的先进技术，后台服务运行在高性能Node.js上，依托异步语法更先进的Koa2框架开发，保证后端服务的安全可靠，使用高性能的MongoDB数据库，为网站的开发提供多种功能，前端页面使用Vue.js开发，双向数据绑定的开发模式极大地简便了开发过程。
2.1.1 Node.js平台分析
Node.js是基于Chrome V8引擎的JavaScript运行环境，Chrome V8引擎是由Google开发的开源JavaScript引擎，它由C++编写，通过将JavaScript代码编译成机器码而非字节码来执行代码，大大提高了JavaScript代码的运行效率，其运行速度可媲美二进制编译，同时专注于网络功能，在TCP、HTTP、DNS等方面相当成熟，被用于Google的开源浏览器Chrome中。Node.js的开发者Ryan Dahl巧妙地借助了Chrome V8引擎的高效性和JavaScript语言的事件驱动模式开发了Node.js，Node.js作为单线程、事件驱动的运行平台，开发时只能使用异步IO，虽然Web开发者更喜欢写同步IO，但是使用异步IO却能获得更高的性能，这解决了以往其他服务端语言难以开发高并发应用的问题。

图：多线程与单线程的区别
　　同时，Node.js作为开放的运行平台，用户可以通过其配套的npm管理器免费下载其他用户分享的npm包，也可以分享自己的代码包，目前其已成为全球最大的开源库系统。当用户发布程序时只需要附上程序使用的npm包，其他用户便可自行安装依赖，提高了开发速度。使用Node.js不仅可以用来开发Web服务器，得益于其前端、后端统一的模型和接口，开发人员可以在前端和后端开发中灵活地穿梭，现在许多的前端开发框架也开始依赖Node.js来编译开发。
　　传统的服务器开发常常要为高并发而烦恼，多线程会导致上下文切换的开销与资源消耗，在等待资源时会阻塞线程。Node.js摈弃了以往Web开发语言的线程驱动编程，而采用异步IO和事件循环机制，适合用来开发非阻塞式的应用和系统开发。这里可以这样理解事件驱动，当Node.js收到一个新请求时会将其压入队列尾部，再循环检测队列中的事件状态变化，根据监听事件的状态变化来做对应操作，通过回调的方式完成请求，系统只需集中资源专注处理队列中的一个事件，因而其具有高的运行效率。

图：Node.js的事件循环机制
　　知识产权交易平台采用Node.js开发，可以应对大量的网络请求，便于以后的升级扩容，且有强大的开发社区支持，为平台提供有力的保障。
2.1.2 Koa2框架分析
Koa2是新一代Node.js的Web开发框架，提供了一系列功能强大的特性和辅助的包来帮助开发者开发服务器，使用它可以快速地开发Web应用。Express是第一代Node.js的Web开发框架，它对Node.js的http功能进行了封装，使得开发者可以使用封装后的API进行开发，但这些API的语法基于ES5，只能通过回调来实现异步代码，如果异步嵌套层次多，代码就会显得复杂，给开发工作带来负担。在Node.js支持ES6语法后，Express团队重新编写了Node.js的下一代Web开发框架Koa1.0，Koa1.0基于ES6的generator实现异步，代码也简洁了许多。Koa2是Koa1.0的升级版，Koa2使用了ES7语法中提供的async和await，不再使用本意并非用于实现异步的generator，非常简洁且易于使用。
　　Koa2框架有以下特征：
第一，独特的中间件设计理念，通过中间件来对http请求进行处理，开发者可以针对相似的请求开发中间件，轻松实现代码的复用。开发者还可以从npm包管理器中引用一些成熟的中间件，做到对文件上传和下载参数格式化、请求权限检查等操作，服务器接受到的请求就像进入工厂中的流水线般逐一被中间件处理，中间件中包含next()函数，在前一中间件处理完成后会被送入下一中间件处理。

图：Express与Koa的中间件对比
第二，通过路由表对不同的请求进行分别处理，将不同的请求地址和请求方式分别传到不同的处理函数，对于路由表中不存在的请求格式给予拒绝，保证了Web应用的安全性与一致性，在定义路由时还可以指定每一路由使用哪些中间件，让整一项目清晰明了。
第三，Koa2框架还支持ejs模板功能，在一些前后端不分离的项目中可以方便的输出页面，还可以用于邮件模板的发送，它不仅可以在服务端运行还可以运行在客户端。
　　知识产权交易平台采用Koa2框架可以使用上最新的ES7异步语法，代码层次更加鲜明，不仅带来了开发上的便利，而且符合未来技术的发展趋势，为平台的长久运行提供保障。
2.1.3 MongoDB数据库分析
MongoDB是文档导向的数据库管理系统，由C++语言写成，可以为Web服务器提供可扩展的高性能数据存储，它是介于非关系型数据库和关系型数据库之间的产品，保持强大非关系型数据库功能的同时，为开发者提供了一些传统数据库拥有的功能。
　　MongoDB数据库有以下特征：
第一，MongoDB作为一个面向文档存储的数据库，操作简便，可以方便地存储Json对象，不需要对数据进行特别的转换。
第二，在MongoDB中可以为记录中的属性增加索引，可以给数据快速进行排序，读取速度更快。
第三，MongoDB具有高扩展性，在数据库数据量特别大的情况下，可以对数据库进行分布式扩容，给平台后续建设提供更多可能性。
第四，MongoDB提供GridFS功能，可以用来存放小的文件，平台的图片文件可以交由MongoDB存储，管理图片文件更加清晰简明。
第五，MongoDB支持JAVA、C++、PHP、C#、Python等各种编程语言，后续平台可以在此数据库基础上进行大数据开发，为平台提供更丰富的资源。
　　知识产权交易平台采用MongoDB数据库，既为网站用户、知识产权数据提供有力支撑，也为网站未来更复杂、更加多样化数据存储提供可能。
2.1.4 Vue.js前端框架分析
Vue.js前端框架是用于创建用户界面的开源JavaScript渐进式框架，更加关心MVC模式中的视图层，通过组件中的方法实现视图与模型间数据的绑定，使得创建单页面应用时页面数据更新更加简便，极大地简化了Web前端的开发，开发者可以将精力更多地放在数据的获取、处理和发送。
　　Vue.js具有以下特征：
第一，Vue.js前端框架具有先进的组件开发思想，过去在后端才能实现的组件开发、组件复用成功的在浏览器前端实现，组件开发者可以更集中精力于组件的开发与复用，每一组件可以完整地包含HTML、CSS和JavaScript代码，而且Node.js的开发环境基于Node.js，开发者可以方便地将组件打包上传到npm包管理器，与其他开发者共享组件。
第二，Vue.js前端框架采用了响应式设计，它是一个提供MVVM风格的双向数据绑定的库，开发者只要将视图与模型进行绑定，Vue会在数据中加入监视函数，当数据变化时视图也会相应的改变，而且Vue.js框架提供了许多操作视图的功能，html代码也能实现if条件判断、for循环等功能，前端开发人员不再需要操作复杂的html代码拼接。

图：Vue.js的双向数据绑定模型
第三，Vue.js前端框架提供了一系列配套的包，包括用来构建复杂多页面应用的vue-router、用来实现数据共享的vuex、用来构架包含Vue.js的webpack项目的vue-cli脚手架等包功能，开发者可以根据开发需求自由定制，还可以用上axios来实现http请求的发送与接收。

图：Vue.js组件通过webpack打包成网页代码
第四，Vue.js前端框架由国人尤雨溪开发，其文档和社区有完善的中文支持，有不懂的问题可以在社区中进行提问，同时作为一个还在不断开发更新中的前端框架，开发团队也在持续更新框架功能，一些框架中存在的小问题都可以迅速得到修补。
第五，Vue.js前端框架使用人数多，虽然其是2014年新发布的框架，但是其星标数在开源代码分析网站Github上排名前十，互联网上关于它的问题讨论与文章数量多，越来越多的网站项目也用上了这一框架。
第六，Vue.js前端框架的良好生态催生了一批基于Vue.js框架开发的项目，Element-UI就是由饿了么团队基于Vue.js2.0开发的桌面UI，前端开发者可以借用其成熟的组件进行前端开发，其组件不仅提供了良好的配色，还提供数据校验等功能。
　　知识产权交易平台采用Vue.js前端框架搭配Element-UI组件库开发，有利于开发高效化和维护条理化，是平台开发的创新尝试。
2.1.5 前后端分离分析
在MVC架构中，传统做法是浏览器向服务器发送请求，服务器在收到请求后对请求进行解析，向数据库查询所需的数据，在对数据进行格式化后填充至模板，在页面完成渲染后将页面返回至前端浏览器，完成这一请求功能。这种做法虽然可以减轻浏览器端的压力，却对后端服务器提出了巨大的性能要求，后端需要耗费大量的资源，而传输的数据有很大一部分是重复的，真正有关用户的数据却很少。随着互联网技术的发展，人们对网页的需求不再仅仅停留在能用，而要既好用又好看，网页内容的增大对后端服务器提出了更高的业务要求。这种情况下，通过JavaScript代码实现异步网络请求，服务器不用再对每个请求都返回页面，而只要返回部分数据。

图：前后端分离架构图
　　而在电脑设备、移动端设备处理能力不断提升的今天，前端处理能力已不再是网络技术的瓶颈，人们越来越多地关注服务器的高并发性和高可用性，渐渐希望能将尽可能多的请求由过去的返回页面转变为返回格式化的JSON数据。在网络技术的支撑下，前后端分离的设想渐渐成为可能，用户访问到的网页完全可以存放在静态服务器，而针对数据处理的业务可以放在后端服务器，后端服务器只处理数据和传输数据，很大程度减轻了其压力，可以同时处理更多请求。
　　前后端的分离也有利于Web的开发，前端和后端工程师可以各自专注于自身工作，双方只要通过接口文档进行数据的对接，同时，后端接口不仅可被前端界面使用，还可以根据这些接口开发对应功能的移动端APP，实现接口的复用，一举多得。
　　知识产权交易平台正式采用了前后端分离的设计方案，前端界面APP化，与后端服务器通过json数据格式交换，使得服务器稳定且高效。
2.2 经济可行性
　　知识产权交易平台开发过程中使用的软件都是开源软件，无需任何授权收费负担，且平台采用成熟方案构建，对服务器要求不高。在开发过程中参考了学校图书馆和电子资源库中的资料，在平台开发过程中，学生使用自有计算机进行开发，使用自有移动端设备测试，无需额外租借或购买其他设备，且服务器可在个人开发环境搭建，无额外经济成本。因此，知识产权交易平台的开发、建设具有极强的经济可行性。
2.3 社会可行性
　　社会上知识产权交易需求日趋旺盛，急需这样一个知识产权交易平台来提供服务，平台的开发迎合了社会的发展需求，必将为知识产权创造者和企业带来新体验。平台依托于互联网技术，上线后可以在全世界范围内访问，受众广、潜在用户多，且平台准入门槛低，只有拥有普通电脑或移动端设备皆可访问，人人都可参与到知识产权交易中来，具有良好的社会意义。
2.4 开发可行性
　　开发前经过讨论与方案的制定，并与指导老师进行了交流，开发方案在讨论中明朗确定。开发前做了详细的准备工作，对方案中未使用过的新鲜工具进行了深入的学习，并参考了许多项目开发经验。在开发过程中使用了版本控制工具，在每天开发工作完成时都将代码提交至Github私有库中，保证了代码的数据可靠性，且依托可靠的开发技术，开发可行性极高。
2.5 操作可行性
　　功能上，平台功能模块清晰明了，前台、用户中心、管理员中心模块功能分明，用户不用过多摸索就能学会平台的操作，学习成本低。界面上，平台基于响应式布局，在电脑端和手机端均有良好的浏览效果，且在开发过程中多次对平台进行浏览体验，针对一些体验不佳的地方及时进行了调整。因此，本平台具有很高的操作可行性。
3.需求分析
3.1 功能需求
　　知识产权交易平台将根据购物网站的设计经验进行开发，平台包括三部分：前台展示部分、用户中心部分、管理员中心部分，具体实现以下功能：
1. 用户登录模块：通过生成token存放在用户浏览器中，辨别用户是否登录。
2. 用户登出模块：通过清除用户浏览器中的token，重置用户的登录状态
3. 用户注册模块：对用户信息进行检查，检查无误可进行注册。
4. 获取用户状态模块：根据用户请求头中token信息，判断用户是否登录并返回一些用户基本数据。
5. 获取用户资料模块：查询用户基本资料并在用户中心展示。
6. 用户资料修改模块：用户对个人资料进行修改。
7. 获取验证邮件模块：为保证平台安全，用户需要在验证邮箱后才可进行平台信息发布和修改操作。
8. 找回密码模块：用户可以通过注册账号获取网页链接来重置密码。
9. 修改邮箱模块：邮箱修改涉及新旧邮箱的替换机制，平台只在用户通过新邮件验证后才对邮箱进行更新。
10. 修改密码模块：在验证原密码后对新密码加密后进行存储。
11. 获取所有用户信息模块：管理员获取用户信息列表。
12. 产权发布、修改模块： 用户发布新的知识产权信息或对已发布的知识产权信息进行更新。
13. 获取产权列表： 用户查看自己发布的产权信息列表或管理员查看平台所有用户的产权列表。



3.2 安全需求
　　平台的安全可靠、用户的账户安全是平台开发工作中的重点，对此，平台在安全性上做了以下考量：
第一，平台根据用户ID生成token，并将token存在用户浏览器cookie中，根据用户请求头部的token对用户身份进行验证。
第二，在用户注册、登录、修改密码等设计关键数据的操作，平台在前端和后端都采用了严格、同标准的信息校验机制，确保用户账户安全。
第三，平台在存储密码时，对密码进行加盐和哈希，用户校验密码时同样对密码进行加盐和哈希，根据哈希结果判断用户登录状态，避免再数据库中存放明文密码带来的风险。
第四，在发送用户验证邮件或密码重置邮件时，平台同样采用token验证的形式，token采用与用户登录不一样的密匙生成，安全可靠。
第五，平台采用中间件的方式对用户权限进行控制，数据请求的权限检测过程安全而且简明易懂。
3.3 性能需求
　　平台采用前后端分离的设计方案，平台前端不管是在电脑还是在移动端都能稳定运行，平台后端采用异步IO的事件驱动模式，可以应对高并发量，对服务器性能要求低，采用的Koa2框架具有稳定性高的特点，可以提供全天候的服务。
4.总体设计
4.1 系统结构设计
　　根据前后端分离的设计思想，平台前端存放在静态资源服务器，平台后端存放在数据处理服务器，在条件允许的情况下可将数据库放在单独的数据库服务器。当用户访问知识产权交易平台时，网址指向静态资源服务器，用户浏览器会从静态资源服务器加载前端页面，前端页面中包含了页面的框架、页面的风格样式和请求数据的方法，在加载完成前端页面后，浏览器会根据页面中包含的接口信息和触发条件依次向后端服务器发起请求，后端服务器接受到请求后对请求合法性进行判断，对不合法请求给予错误响应，对合法请求根据需求向数据库服务器查询数据，将请求到的数据以json格式返回给前端页面，前端页面在接受到数据后，按照视图与模型绑定的关系，将数据显示到视图上，这样就完成了页面的显示。
平台后端采用基于Node.js的新一代Web框架Koa2设计，在官方模板范例的基础上，引入了用于密码哈希的bcrypt、用于连接MongoDB数据库的mongoose驱动、用于发送电子邮件的nodemailer、用于对请求格式化的body-parser和用于token生成的jsonwebtoken等第三方库，根据需求编写检查用户token的checkToken中间件、用于检查管理员权限的checkAdmin中间件、用于检查用户是否验证邮件的checkEmail中间件、用于检查用户是否被禁用的isDisabled中间件和对管理员和用户公用接口进行处理的isAdmin中间件，对于具体的不同请求采用不同的函数方法进行处理。这样，当一个请求发送至后端服务器时，会先经过body-parser中间件进行格式化处理，再到路由宝中根据请求的内容查看需要再经过哪些中间件处理，在中间件处理完数据后，可以在请求体中插入一些下一步需要用到的资料，最后送至对应的函数进行处理，处理过程中可能就会用到第三方库功能，最后将响应信息返回给用户。而在这一过程中，任何不合法的请求都会被拦截，返回错误信息。

图：系统架构图
　　使用第三方库可以提高后端的开发效率，这里对一些第三方库的使用方法进行举例：
Mongoose：用于连接MongoDB数据库，提供多种方法对数据库进行操作。使用mongoose首先要建立与数据库的连接，并定义集合Collection里文档document的结构Schema，根据这个Schema编译出模型Model，通过这个Model可以实现文档的增删改查。Schema定义时要指明文档对象的属性，还可以给属性赋默认值，方便新建数据时的自动赋予初始值；Model提供了多种操作数据库方法，比如：插入新数据的save方法、查找数据的find, findById, findOne方法、修改数据的update, updateMany, updateOne方法、删除数据的remove等，通过这些方法可以简化许多数据的操作方法。
bcrypt：用来增强密码安全性，它通过加盐来防御彩虹表攻击，其流程是：随机生成盐值salt，将salt附加到密码后共同哈希，最后返回salt与哈希后的值的拼接结果。而其校验流程则是：将salt从加密后的密码中剪切出来。将待校验的密码与salt共同哈希，并与先前的哈希结果进行比对，得出密码的正确与否。存储在数据库中的密码由三部分组成，加密轮数、salt和哈希后的结果，巧妙地设计兼顾了安全与简洁。

图：经Bcrypt哈希后的密码
jsonwebtoken：用来在用户和服务器间传递被认证的用户身份信息，以便从服务器获取资源。传统的服务器采用Session认证机制，为了在无状态的http请求中辨认用户，服务器给连接到服务器的用户分配session值，session值存储在用户的cookie中，服务器根据用户请求时携带的session值辨别用户，服务器会在内存中存放用户的session信息，随着用户数量的增加，服务器负担会变重，而且这样的认证机制要求用户请求的是同一台服务器，这样的认证机制无法做分布式推广，限制了负载均衡的能力。使用token后服务器就不再需要在内存中记录用户的登录状态了，给平台扩展提供了可能。jsonwebtoken由三段信息组成：头部(header)、载荷(payload)、签证(signature)，头部记录token采用的加密算法，载荷存放用于辨别用户的信息、签发时间、过期时间，这部分内容是用户和服务器都可以解析的，签证是服务器对头部和载荷的加盐哈希，服务器可以签发和验证，但用户无法伪造。知识产权交易平台在用户登录和邮件认证上都用了jsonwebtoken，用户登录时token存放在用户cookie中，且设置了“http-only”，保证其仅可被后端服务器获取与修改。

图：Json Web Token的组成
　　平台前端采用Vue.js前端框架开发，实现了前端页面app化，在官方脚手架vue-cli模板的基础上，引入了用于异步数据请求与接收的axios、用于快速构建页面的Element-UI、用于构建多页面应用的vue-router、用于方便样式表css书写的stylus，通过模板的分层级嵌套，实现了前台页面与后台页面的功能区分。当用户打开平台网站时会加载前端页面，前端页面根据需求向服务器发起请求，将请求到的数据在前端展示，如果返回错误的信息，前端页面要对错误进行拦截，并将错误信息提示给用户，在用户填写用户名、邮箱、密码时，前端页面要实现对数据的校验，拦截错误的请求信息，减轻服务器端压力。
　　这里对前端使用到的一些第三方库进行使用举例：
axios：用于异步数据的请求与接收，在前后端分离的应用中，数据的获取都要靠JavaScript代码实现，原生的JavaScript代码操作复杂，因此诞生了JQuery等前端库，而axios是Vue.js请求数据的不二选择，其具有简明的GET、POST方法，还可以添加拦截器对请求数据或响应数据做拦截。在知识产权交易平台前端页面中，就设置了响应拦截器，对状态码非200请求成功的接口进行了拦截，并在页面上显示服务器返回的错误的信息。
Element-UI：用于快速构建网站的组件库，知识产权交易平台中使用了其提供的消息提示、输入框验证、弹窗等功能，可以不用花费精力在这些功能的具体实现上，在这些组件的基础上进行再创作和风格改造。





4.2 系统功能设计
　　知识产权交易平台主要包含以下内容：用户登录登出模块、用户注册模块、获取验证邮件模块、找回密码模块、修改邮箱模块、密码修改模块、用户资料修改模块、知识产权发布模块、用户管理模块。下面详细介绍这些模块：
1.用户登录、登出模块：包含登录与登出接口。登录接口对前端页面传输过来的账号、密码格式进行校验，如果格式正确再在数据库中检索账号，再比对数据库中该账号的密码与请求中的密码，如果正确则生成token并返回给前端；登出接口则给前端返回空的token，覆盖先前存在的token，完成退出。
2.用户注册模块：用户注册接口对前端页面传输过来的用户名、邮箱和密码格式进行校验，如果格式正确再在数据库中检索用户名或邮箱是否已经存在，如果都不存在则将数据写入数据库，生成token返回给前端，并向邮箱发送验证邮件。
3.获取用户状态模块：获取用户状态模块不需要传入参数，服务器会根据请求头中的token返回当前是否已经登录、登录的用户名和是否管理员。
4.获取用户资料模块：获取用户资料模块不需要传入参数，服务器会返回当前用户的资料信息，包括用户的用户ID、用户名、邮箱、电话、QQ号码、微信号、邮箱是否通过验证、是否接收通知邮件、账号是否被禁用、账户创建时间。
5.用户资料修改模块：用户资料修改接口需要传入用户名、电话、QQ号码、微信号、是否接收通知邮件参数，并再用户名校验无误后存入数据库。
6.获取验证邮件模块：获取验证邮件接口不需要传入参数，服务器会检查当前用户是否未验证邮箱，如果未验证则发送验证邮件，邮件链接通过jsonwebtoken生成，载荷当中包含用户ID和待验证邮箱，安全性高。
7.找回密码模块：找回密码分为三个接口。发送重置密码邮件接口传入用户名或邮件名，如果账号存在则发送邮件；检查token是否有效接口传入token参数，如果token有效返回正确消息；重置密码接口传入token和新密码，如果token有效且密码格式正确则修改数据库中密码。
8.修改邮箱模块：修改邮箱模块分为两个接口。发送验证邮件接口传入旧密码与新邮箱，在旧密码正确且新邮箱不存在于数据库的情况下发送验证邮件至新邮箱，邮件链接通过jsonwebtoken生成，载荷当中包含用户ID与待验证邮箱；检验token接口传入token参数，如果token有效则修改用户邮箱为载荷中的新邮箱。
9.修改密码模块：密码修改接口传入旧密码与新密码，如果旧密码正确则将新密码写入数据库。
10.产权发布模块：用户可以在网站发布自己的知识产权作品。
11.用户管理模块：管理员可对用户进行操作。

图：系统模块结构图

4.3 系统数据库设计
　　知识产权交易平台设计得实体有：用户User实体和知识产权Property集合。具体设计如下：
　　用户User集合：记录用户的用户名、邮箱、密码、电话、QQ号码、微信号码、是否接收提醒邮件、是否管理员、是否已验证邮箱、是否被禁用、是否被删除、创建用户时间。

图：用户实体图
　　产权Property集合：记录知识产权的创建者用户ID、产权名、摘要、详情、状态、创建时间、是否被禁用、是否删除。

图：产权实体图
5.详细设计
5.1 视图层设计
　　平台采用简明轻快的设计风格，使用媒体查询，页面支持自适应。首页由导航栏和内容两部分组成；用户中心由导航栏，功能菜单和功能区组成。其中，导航栏使用fixed位置参数，固定于浏览器页面顶端，并限制了内容的宽度为1000px，避免内容过于分散；用户中心的菜单通过js代码监听浏览器的“document.documentElement.clientWidth”，实现菜单的自动收缩与展开，当页面宽度小于1000px时收缩，节省页面空间，当页面宽度大于1000px时展开。

图：用户中心设计图
5.1 控制层设计
5.1.1 后端中间件设计
　　平台虽然功能模块多，但是有一些请求的功能是有类似的或有做一些相同操作的，针对这些类似操作，后台系统中开发了一些中间件，下面对这些中间件进行介绍：
checkToken：用于对需要用户权限的操作进行权限的检测，这个中间件会先对请求中的token进行检查，如果不存在token返回错误结果，如果存在token再对token进行验证，token签名错误或过期都会返回错误，在确认token合法后会根据token中的user_id在数据库中进行检索，如果用户不存在或用户已被删除都会返回错误，如果找到用户，会将用户信息放入请求体中，避免之后的操作需要再从数据库检索用户信息。只有请求正确，程序才会进入下一函数。

图：checkToken中间件流程图
checkEmail：对用户是否已验证邮箱进行检测，出于安全考虑，未经邮箱验证的用户无法进行知识产权发布等更多功能。因为检测邮箱是否登录建立在用户已经登录的基础上，中间件直接从request请求体中拿出checkToken放入的用户信息，检查邮件是否经过验证，未验证返回错误信息，已验证再传入下一函数。

图：checkEmail中间件流程图
checkAdmin：对用户是否是管理员进行检测。检测是否管理员同样建立在用户已经登录的基础上，这里同样对请求体中的用户信息里的‘isAdmin’进行检查。

图：checkAdmin中间件流程图
5.1.2 前端消息拦截
　　平台采用了前后端分离的设计方式，错误信息不再直接在页面中显示，前端页面在请求API接口时遇到的错误会通过页面消息的方式提示用户。为此，平台针对多种可能出现的错误情况，统一设计了消息的提醒方式：
Code	消息提示形式
1	请求成功，不显示消息提醒
2	请求成功，将‘msg’以文本的形式显示在绿色success消息提醒中
3	请求成功，将‘msg’以HTML的形式显示在绿色success消息提醒中
4	将‘msg’以文本的形式显示在黄色warning消息提醒中
5	将‘msg’以HTML的形式显示在黄色消warning息提醒中
6	请求错误，将‘msg’以文本的形式显示在红色error消息提醒中
7	请求错误，将‘msg’以HTML的形式显示在红色error消息提醒中
8	将‘msg’以文本的形式显示在灰色消息提醒中
9	请求错误，将‘msg’以文本的形式显示在红色error消息提醒中，并跳转至首页
表：前后端消息码含义对照表
　　前端页面根据后台响应中的code响应码，在页面上方醒目位置显示消息提醒，借助前端框架中引入的axios异步请求模块提供的拦截器功能，在拦截器中对每一条响应信息进行预处理，按照对照表的设计进行对应的弹窗。其中，在一些页面访问后即刻加载数据且成功的请求采用响应码1，不提示用户；大多数消息采用文本的形式展示，HTML消息用于在消息中加入超链接指引用户前往其它页面；黄色的warning消息目前用于提醒用户验证邮箱；灰色消息用于获取用于获取用户状态失败的情况；响应码9用于用户权限不足的异常情况，前端页面接收到此响应码会跳转至首页。在平台以后的开发过程中，也会对消息状态码表不断完善。

图：消息提醒效果图
5.1.3 用户登录模块
平台共设有三种用户权限，包括游客、普通用户和管理员，他们共用同一个数据库存储，普通用户拥有游客的功能，管理员拥有普通用户和游客的功能，其中普通用户和管理员需要登录，而区分普通用户与管理员的权限靠的是数据库中的“isAdmin”字段。因为，用户权限的控制是由后台控制，所以，普通用户和管理员可以共用同一个登录系统，通过获取到的token确认用户。
接口	/login	方法	POST
请求参数	account：用户名或邮箱	响应参数	code：响应码
	password：密码		msg：消息
表：用户登录接口请求、响应参数
平台对用户名、账号、密码做了格式上的要求，用户名的要求是至少4个字符、只能由汉字、英文、数字和下划线构成、不能全由数字构成；密码的要求是至少8个字符、由字母和数字组成、必须包含字母和数字组成。验证用户名、邮箱和密码用到了正则表达式，验证用户名用到了正则表达式“^(?![0-9]+$)(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5] {4,20}$”，验证邮箱用到了正则表达式“^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+ [-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$”，验证密码用到了正则表达式“(?=.*[A-Za-z]) (?=.*\d)[A-Za-z\d] {8,20}$”。在平台的前后端都用了同样的校验方法，保证了一致性。
当用户在登录框中输入账号和密码时，前端页面会对账号和密码分别进行格式验证，其中账号可以是用户名或密码，如果账号或密码格式错误，前端页面会在输入框下方提醒用户更正，在格式输入正确之前用户无法提交登录。在用户输入正确格式的账号和密码并点击登录后，页面会以账号和密码为参数向服务器的‘/login’接口发送登录的post请求。

图：用户登录流程图
5.1.2 用户登出模块

图：用户登出流程图
5.1.3 用户注册模块

图：用户注册流程图
5.1.4 获取用户状态模块

图：获取用户状态流程图
5.1.5 获取用户资料模块

图：获取用户资料模块
5.1.6 用户资料修改模块
-+
图：用户资料修改流程图
5.1.7 获取验证邮件模块

图：获取验证邮件流程图
5.1.8 找回密码模块

图：重置密码流程图
5.1.9 修改邮箱模块

图：修改邮箱流程图
5.1.10 修改密码模块

图：修改密码流程图
5.1.11产权发布模块
5.1.12 用户管理模块
5.2 模型层设计
5.3 数据库设计
6.系统测试与维护
6.1 白盒测试
6.2 黑盒测试
6.3 系统维护
参考文献
附录
致谢